/*! d3-traits - v0.0.1 - 2013-10-07
* https://github.com/gec/d3-traits
* Copyright (c) 2013 d3-traits; Licensed ,  */
!function(a){function b(a,b){for(var c in a)c in b||(b[c]=a[c])}function c(a,b){var c=a[b];return c||(a[b]={},c=a[b]),c}function d(a){return"x"===a.charAt(0)}function e(a){return"y"===a.charAt(0)}function f(a){return a[a.length-1]}function g(b,c){return a.max(b,function(a){return c(a).length})>0}function h(b,c){return a.trait.utils.isX(c)?[b.minRangeMarginLeft(c),b.chartWidth()-b.minRangeMarginRight(c)]:[b.chartHeight()-b.minRangeMarginBottom(c),b.minRangeMarginTop(c)]}function i(a,b){var c=parseFloat(a);return isNaN(c)?b:c}function j(a,b){if(!a)return b;var c={};return c.top=i(a.top,b.top),c.right=i(a.right,b.right),c.bottom=i(a.bottom,b.bottom),c.left=i(a.left,b.left),c}function k(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function l(){var a,b,c,d,e=arguments[0]||{},f=arguments.length;for(a=1;f>a;a++)if(null!=(b=arguments[a]))for(c in b)d=b[c],d&&(e[c]=d);return e}function m(a,b){for(var c in b)a.hasOwnProperty(c)||b[c]&&(a[c]=b[c]);return a}function n(a,b){var c=k(a);return c||(c={}),m(c,b)}function o(a,b,c){function d(a,b){return"_"+a+"_"+b}function e(a,b,c){return console.log("makeVirtual "+a),function(a,b){return function(){var a=this._super;this._super=c;var d=b.apply(this,arguments);return this._super=a,d}}(a,b)}console.log("trait( "+a.name+")");var f,g,h=this;h.config=b,h._super=c,h.index=-1,h.getImp=function(){return g},h.trait=function(a,b){var c=new o(a,b,g);return c.getImp()},h.call=function(a){return this._super&&this._super.call(a),a.call(g),g},h.__replaceVirtual=function(a,b){g.hasOwnProperty(a)&&(g[a]=b),c&&c.__replaceVirtual(a,b)},h.__virtualize=function(b,d){console.log("__virtualize begin "+a.name+" name="+b);var f=null;return g.hasOwnProperty(b)&&"function"==typeof g[b]?(console.log("__virtualize "+a.name+" name="+b+" hasFunction"),f=e(b,d,g[b]),g[b]=f,c&&c.__replaceVirtual(b,f)):console.log("__virtualize "+a.name+" name="+b+" hasFunction NOT  "),f},h.__makeVTable=function(){console.log("__makeVTable begin "+a.name);var b,d;for(b in g)d=c.__virtualize(b,g[b]),d?(console.log(a.name+".__makeVTable name "+b+"   virtualized"),g[b]=d):console.log(a.name+".__makeVTable name "+b+" ! virtualized");for(b in c)b in g||(g[b]=c[b]);console.log("__makeVTable end")},h.__getRoot=function(){return h._super?h._super.__getRoot():h},f=d(a.name,h._traitIndex),c&&(h.config=n(b,h.__getRoot().config)),g=a(c,h.config,f),c&&h.__makeVTable(),g.call=h.call,g.trait=h.trait,g.getImp=h.getImp,g.config=h.config,g.__makeVTable=h.__makeVTable,g.__virtualize=h.__virtualize,g.__replaceVirtual=h.__replaceVirtual,g.__getRoot=h.__getRoot,g._super=c}function p(a,b){return new o(a,b).getImp()}Array.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},o.prototype={trait:function(a,b){var c=new o(a,b,this),d=c.getImp();return d},__getRoot:function(){return this._super?this._super.__getRoot():this},callInstance:function(a){var b=this;a.call(function(a){a.each(function(c){b(c,a)})})},call:function(a,b){return b||(b=this),this.__leafTrait=b,this._super&&this._super.call(a,b),a.call(this),this}},o.prototype.constructor=o,a.selection.prototype.trait=function(a,c){if(Array.isArray(a))for(var d in a)this.trait(a[d]);else{this._traitsInitialize();var e=this.traits.length,f={};e>0&&(f=this.traits[e-1]);var g=n(this._traitsConfig,c),h=a(f,g,this);b(f,h),this.call(h),this.traits.push(h)}return this},a.selection.prototype.callTraits=function(){for(var a in this.traits){var b=this.traits[a];this.call(b)}return this};var q={};a.selection.prototype._traitsInitialize=function(){return this._traitsConfig||(this._traitsConfig=k(q)),this.traits||(this.traits=[]),this},a.selection.prototype.traitConfig=function(a){this._traitsInitialize();for(var b in a)this._traitsConfig[b]=a[b];return this},a.trait=p,a.trait.scale={},a.trait.chart={utils:{}},a.trait.axis={},a.trait.control={},a.trait.focus={},a.trait.legend={},a.trait.utils={clone:k,extend:l,isX:d,isY:e,isData:g,extentMax:f,getChartRange:h,getTraitCache:c,configMargin:j,configFloat:i}}(d3),function(a,b){function c(a,b){this.x=a,this.y=b}function d(a,b){this.width=a,this.height=b}function e(){var a,b;switch(arguments.length){case 0:this.top=0,this.right=0,this.bottom=0,this.left=0;break;case 1:a=arguments[0],this.top=a,this.right=a,this.bottom=a,this.left=a;break;case 2:a=arguments[0],b=arguments[1],this.top=a,this.right=b,this.bottom=a,this.left=b;break;case 3:this.top=arguments[0],this.right=arguments[1],this.bottom=arguments[2],this.left=arguments[1];break;case 4:this.top=arguments[0],this.right=arguments[1],this.bottom=arguments[2],this.left=arguments[3]}}function f(a,b,e,f,g,h){switch(arguments.length){case 0:this.origin=new c(0,0),this.size=new d(0,0),this.anchor=new c(0,0);break;case 2:this.origin=new c(a.x,a.y),this.size=new d(b.width,b.height),this.anchor=new c(0,0);break;case 3:this.origin=new c(a.x,a.y),this.size=new d(b.width,b.height),this.anchor=new c(e.x,e.y);break;case 4:this.origin=new c(a,b),this.size=new d(e,f),this.anchor=new c(0,0);break;case 6:this.origin=new c(a,b),this.size=new d(e,f),this.anchor=new c(g,h)}this.minX=function(){return this.origin.x-this.size.width*this.anchor.x},this.maxX=function(){return this.origin.x+this.size.width*(1-this.anchor.x)},this.minY=function(){return this.origin.y-this.size.height*this.anchor.y},this.maxY=function(){return this.origin.y+this.size.height*(1-this.anchor.y)},this.spaceOnTop=function(a){return this.minY()-a.maxY()},this.spaceOnBottom=function(a){return a.minY()-this.maxY()},this.roomOnRight=function(a){return a-this.maxX()},this.roomOnBottom=function(a){return a-this.maxY()},this.roomOnLeft=function(){return this.minX()},this.roomOnTop=function(){return this.minY()}}function g(a,b){return a.rect.origin.y-b.rect.origin.y}function h(a,b){for(var c=null,d=a.length-1;d>=0;d--){var e,f=a[d],g=f.rect;e=d===a.length-1?b-g.maxY():c.rect.spaceOnTop(g),0>e&&(g.origin.y+=e),c=f}}function i(a,b,c){var d=0;c>0?d=-c-b:0>b&&(d=-b),a.origin.y+=d}function j(a,b){var c,d=null;a.forEach(function(a,e){c=a.rect,0===e?i(c,c.minY(),b):i(c,c.spaceOnTop(d.rect),b),d=a})}function k(a,b,c,d){for(var e,f=b;c>f;f++)e=a[f],e.rect.origin.y+=d}function l(a,b,c){for(var d,e,f,g=0,h=0,i=0,j=0,l=null,m=0,n=0;g<a.length;g++){if(f=a[g],d=f.rect,e=0===g?d.minY():d.spaceOnTop(l.rect),e>0)if(i>0){if(n=m/i,-1>n||n>1){var o=n;n=n>0?Math.min(n,j):-Math.min(-n,e),k(a,h,g,-n),j-=n,e+=n,e>0?(i=1,h=g,j=e,m=0):(m=(o-n)*i,i++,m+=d.origin.y-c[g])}}else i=1,h=g,j=e,m+=d.origin.y-c[g];else i++,m+=d.origin.y-c[g];l=f}if(i>1&&(n=m/i,-1>n||n>1)){if(n>0)n=Math.min(n,j);else{var p=l.rect.roomOnBottom(b);n=p>0?-Math.min(-n,p):0}k(a,h,g,-n)}}function m(b,c){if(!(b.length<=0)){b.sort(g);var d=0,e=0,f=a.sum(b,function(a){return a.rect.size.height}),i=b.map(function(a){return a.rect.origin.y});f>c?e=(f-c)/b.length:d=c-f,j(b,e),d>0&&(h(b,c),l(b,c,i))}}function n(a,b){var c,d=[],e=[];return a.forEach(function(a){c=a.rect,c.anchor.x<.5?c.roomOnRight(b)>=0?(a.orient=q,e.push(a)):(a.orient=p,c.anchor.x=1,d.push(a)):c.roomOnLeft()>=0?(a.orient=p,d.push(a)):(a.orient=q,c.anchor.x=0,e.push(a))}),[d,e]}function o(a,b,c){var d=n(a,b);m(d[0],c),m(d[1],c)}var p=-1,q=1;b.layout||(b.layout={utils:{}}),b.Point=c,b.Size=d,b.Margin=e,b.Rect=f,b.layout.adjustOrientationToFitWidth=n,b.layout.vertical=m,b.layout.verticalAnchorLeftRight=o,b.layout.utils.listNudgeUpFromBottom=h,b.layout.utils.removeOverlapFromTop=j,b.layout.utils.listBalanceFromTop=l}(d3,d3.trait),function(a,b){function c(a,b){return b?b:"x"===a?"bottom":"left"}function d(a){var b=a.axis,d=b.charAt(0);return{name:b,axisChar:d,accessData:a[b],axisMargin:a.axisMargin||30,orient:c(d,a.orient),ticks:a.ticks,extentTicks:a.extentTicks||!1,tickSize:a.tickSize,tickPadding:a.tickPadding,tickFormat:a.tickFormat,nice:a.nice}}function e(a,b){switch(b.orient){case"left":a.plusMarginTop(2),a.plusMarginLeft(b.axisMargin);break;case"bottom":a.plusMarginBottom(b.axisMargin);break;case"top":a.plusMarginTop(b.axisMargin);break;case"right":a.plusMarginTop(2),a.plusMarginRight(b.axisMargin)}}function f(a,b){switch(b.orient){case"left":return null;case"bottom":return"translate(0,"+a.chartHeight()+")";case"top":return null;case"right":return"translate("+a.chartWidth()+")";default:return null}}function g(a,b,c){c.extentTicks?a.tickValues(b.domain()):c.ticks&&a.ticks(c.ticks),c.tickSize&&a.tickSize(c.tickSize),c.tickPadding&&a.tickPadding(c.tickPadding),c.tickFormat&&a.tickFormat(c.tickFormat)}function h(b,c){function h(b){var c=h;b.each(function(){i||(i=this._container.append("g").classed("axis axis-"+k.name,!0),j=a.svg.axis()),j.scale(l).orient(k.orient),g(j,l,k),i.attr({transform:f(c,k)}).call(j)})}var i,j,k=d(c),l=b[k.name]();return e(b,k),h.update=function(a,c){return this._super(a,c),g(j,l,k),0===c?i.call(j):i.transition().duration(c||b.duration()).ease("linear").call(j),this},b.onChartResized("axisLinear-"+k.name,h),b.onRangeMarginChanged("axisLinear-"+k.name,h),h}function i(b,c){function h(b){var c=h;b.each(function(){i||(i=this._container.append("g").classed("axis axis-"+m.name,!0));var b=n.domain();l.range(n.range()),l.domain(n.domain()),m.nice&&l.nice(m.nice),n=l,k.scale(n).orient(m.orient),g(k,n,m),i.attr({transform:f(c,m)}).call(k);var d=i.selectAll("path.axis-extension").data([b[0]]);d.transition().attr("class","axis-extension").attr("d",function(a){return"M0,0L"+n(a)+",0"}),d.enter().append("path").attr("class","axis-extension").attr("d",function(a){return"M0,0L"+n(a)+",0"}),j=a.trait.utils.extentMax(b)})}var i,j,k=a.svg.axis(),l=a.time.scale(),m=d(c),n=b[m.name]();return e(b,m),h.update=function(c,d){this._super(c,d);var e=b[m.name]();l.range(a.trait.utils.getChartRange(b,m.name));var f=e.domain(),g=a.trait.utils.extentMax(f),h=g.getTime()-j.getTime(),n=new Date(f[0].getTime()+h);return l.domain([n,g]),j=g,0===d?i.call(k):i.transition().duration(d||b.duration()).ease("linear").call(k),this},b.onChartResized("axisMonth-"+m.name,h),b.onRangeMarginChanged("axisMonth-"+m.name,h),h}b.axis.linear=h,b.axis.time||(b.axis.time={}),b.axis.time.month=i}(d3,d3.trait),function(a,b){function c(c,d){function e(b){var c=e;b.each(function(b){if(!f){var e=d.chartClass?"chart-area "+d.chartClass:"chart-area";f=this._chartGroup.append("g").classed(e,!0)}var j=d.seriesFilter?b.filter(d.seriesFilter):b;k.domain(j),l.y0(c.chartHeight()),g=f.selectAll(".series").data(j),g.selectAll("path").transition().duration(500).attr("d",function(a){return l(d.seriesData(a))}),g.enter().append("g").attr("class","series").append("path").attr("class","area").attr("d",function(a){return l(d.seriesData(a))}).style("fill",function(a,b){return k(b)}),h=a.trait.utils.extentMax(i.domain())})}var f,g,h,i=c.x1(),j=c.y1(),k=a.scale.category10(),l=a.svg.area().interpolate(d.interpolate||"linear").x(function(a){return i(d.x1(a))}).y0(c.chartHeight()).y1(function(a){return j(d.y1(a))}),m=a.dispatch("customHover");return e.update=function(a,e){this._super(a,e);var f=e||c.duration(),j=function(a){return l(d.seriesData(a))};return h=b.chart.utils.updatePathWithTrend(a,f,i,g,j,h),this},a.rebind(e,m,"on"),c.onChartResized("chartArea",e),e}b.chart.area=c}(d3,d3.trait),function(a,b){function c(a,b,c,d,e,f){return{x:function(c){return e(a.x1(c))+b},y:function(b){return f(a.y1(b))},width:c,height:function(b){return d-f(a.y1(b))}}}function d(b,d){function e(b){var c;if(q){var e="function"==typeof q?q(b):q;c=a.range(e)}else{var f=d.seriesData(b[0]);c=f.map(function(a,b){return b})}return c}function f(b){var q=f;b.each(function(b){var f=d.seriesFilter?b.filter(d.seriesFilter):b,s=a.scale.ordinal().domain(e(f)).rangeRoundBands([0,q.chartWidth()],.1),t=s.rangeBand()/100*p;if(j=s.rangeBand()-t,k=Math.round(t/2-j/2),q.minRangeMarginLeft("x1",Math.ceil(t/2+.4*j+j/2)),!g){var u=d.chartClass?"chart-bar "+d.chartClass:"chart-bar";g=this._chartGroup.append("g").classed(u,!0)}o.domain(f),h=g.selectAll(".series").data(f),h.enter().append("g").attr("class","series").style("fill",function(a,b){return o(b)}),i=h.selectAll("rect").data(d.seriesData),i.transition().duration(500).delay(500).ease(q.ease()).attr(c(d,k,j,q.chartHeight(),m,n)),i.enter().append("rect").classed("bar",!0).attr(c(d,k,j,q.chartHeight(),m,n)).on("mouseover",r.customHover),i.exit().transition().style({opacity:0}).remove(),l=a.trait.utils.extentMax(m.domain())})}var g,h,i,j,k,l,m=b.x1(),n=b.y1(),o=a.scale.category10(),p=0,q=d.barCount,r=a.dispatch("customHover");return f.update=function(e,f){this._super(e,f);var g=a.trait.utils.extentMax(m.domain()),o=m(l)-m(g);return h.attr("transform",null),i.attr(c(d,k,j,b.chartHeight(),m,n)),i=h.selectAll("rect").data(d.seriesData),i.enter().append("rect").classed("bar",!0).attr(c(d,k,j,b.chartHeight(),m,n)),i.exit().transition().style({opacity:0}).remove(),0===f?h.attr("transform","translate("+o+")"):h.transition().duration(f||b.duration()).ease("linear").attr("transform","translate("+o+")"),l=a.trait.utils.extentMax(m.domain()),this},f.gap=function(a){return arguments.length?(p=a,this):p},a.rebind(f,r,"on"),b.onChartResized("chartBar",f),b.onRangeMarginChanged("chartBar",f),f}b.chart.bar=d}(d3,d3.trait),function(a,b){function c(c,e){function f(a){r[a]||(r[a]=b.utils.clone(s))}function g(a,b){if(!arguments.length)return{};if(f(a),1===arguments.length)return r[a];if(!b)return this;var c=r[a],d=!1;return b.left&&b.left<c.left&&(c.left=b.left,d=!0),b.right&&b.right<c.right&&(c.right=b.right,d=!0),b.top&&b.top<c.top&&(c.top=b.top,d=!0),b.bottom&&b.bottom<c.bottom&&(c.bottom=b.bottom,d=!0),d&&E.rangeMarginChanged(),this}function h(a,b){var c="chart-group-clip-path-"+d;return a._chartGroupClipPath=b.append("clipPath").attr("id",c),a._chartGroupClipPathRect=a._chartGroupClipPath.append("rect").attr("width",z).attr("height",A),d++,c}function i(a,b,c){return a[0]>=0&&a[0]<=b&&a[1]>=0&&a[1]<=c}function j(b){var c=j;v=b,b.each(function(){var b=this;if(u=a.select(b),x=b.offsetWidth||x,y=b.offsetHeight||y,z=x-q.left-q.right,A=y-q.top-q.bottom,!b._svg){b._svg=a.select(b).append("svg").classed("chart",!0).attr("width",x).attr("height",y),b._svgDefs=b._svg.append("defs");var d=h(b,b._svgDefs);b._container=b._svg.append("g").classed("container-group",!0),b._chartGroup=b._container.append("g").classed("chart-group",!0),b._chartGroup.attr("clip-path","url(#"+d+")"),this._svg.on("mousemove",function(){var d,e=a.mouse(b._chartGroup.node()),f=i(e,z,A),g=new a.trait.Point(e[0],e[1]);d=f?c.getFocusItems.call(b,g):[],k(b,d)&&l(b,d,g),b.__onFocusChangeLastFoci=d}),this._svg.on("mouseout",function(){var c=a.mouse(b._chartGroup.node()),d=i(c,z,A);d||m(b)})}b._svg.transition().duration(B).attr({width:x,height:y}),b._svg.select(".container-group").attr({transform:"translate("+q.left+","+q.top+")"}),b._chartGroupClipPathRect.attr("width",z).attr("height",A),B=500})}function k(a,b){var c=a.__onFocusChangeLastFoci;if(!c||c.length!==b.length)return!0;for(var d,e,f=c.length-1;f>=0;f--)if(d=c[f],e=b[f],d.index!==e.index||d.point.x!==e.point.x||d.point.y!==e.point.y)return!0;return!1}function l(a,b,c){n(a,"__onFocusChangeListeners",[b,c])}function m(a){n(a,"__onChartMouseOutListeners",[])}function n(a,b,c){if(a[b])for(var d,e=0,f=a[b],g=f.length;g>e;e++)d=f[e],d.apply(a,c)}function o(){var a={chartWidth:z,chartHeight:A};z=x-q.left-q.right,A=y-q.top-q.bottom,(a.chartWidth!==z||a.chartHeight!==A)&&E.chartResized()}function p(){var a={width:x,height:y};x=z+q.left+q.right,y=A+q.top+q.bottom,(a.width!==x||a.height!==y)&&E.chartResized()}var q=a.trait.utils.configMargin(e.margin,{top:5,right:5,bottom:5,left:5}),r={},s={left:0,right:0,top:0,bottom:0};if(e.minRangeMargin)for(var t in e.minRangeMargin)g(t,e.minRangeMargin[t]);var u,v,w="cubic-in-out",x=200,y=100,z=x-q.left-q.right,A=y-q.top-q.bottom,B=0,C="chartResized",D="rangeMarginChanged",E=a.dispatch(C,D);return j.onFocusChange=function(a,b){a.__onFocusChangeListeners||(a.__onFocusChangeListeners=[]),b&&a.__onFocusChangeListeners.push(b)},j.onChartMouseOut=function(a,b){a.__onChartMouseOutListeners||(a.__onChartMouseOutListeners=[]),b&&a.__onChartMouseOutListeners.push(b)},j.remove=function(){v.each(function(){var a=this;a._svg&&(a._svg.remove(),delete a._svg,delete a._svgDefs,delete a._container,delete a._chartGroup,delete a._chartGroupClipPath,delete a._chartGroupClipPathRect,delete a.__onFocusChangeListeners,delete a.__onChartMouseOutListeners)})},j.getFocusItems=function(){return[]},j.update=function(){},j.select=function(){return u},j.width=function(a){return arguments.length?(x=parseInt(a,10),o(),this):x},j.height=function(a){return arguments.length?(y=parseInt(a,10),o(),B=0,this):y},j.marginTop=function(a){return arguments.length?(q.top=a,o(),this):q.top},j.marginBottom=function(a){return arguments.length?(q.bottom=a,o(),this):q.bottom},j.marginLeft=function(a){return arguments.length?(q.left=a,o(),this):q.left},j.marginRight=function(a){return arguments.length?(q.right=a,o(),this):q.right},j.plusMarginTop=function(a){return q.top+=parseInt(a,10),o(),this},j.plusMarginBottom=function(a){return q.bottom+=parseInt(a,10),o(),this},j.plusMarginLeft=function(a){return q.left+=parseInt(a,10),o(),this},j.plusMarginRight=function(a){return q.right+=parseInt(a,10),o(),this},j.chartWidth=function(a){return arguments.length?(z=parseInt(a,10),p(),this):z},j.chartHeight=function(a){return arguments.length?(A=parseInt(a,10),p(),this):A},j.ease=function(a){return arguments.length?(w=a,this):w},j.duration=function(a){return arguments.length?(B=a,this):B},j.onChartResized=function(a,b){var c=C;a&&a.length>0&&(c=c+"."+a),E.on(c,function(){v&&v.call(b)})},j.minRangeMargin=g,j.minRangeMarginLeft=function(a,b){return arguments.length?1===arguments.length?r[a]?r[a].left:0:(f(a),r[a].left<b&&(r[a].left=b,E.rangeMarginChanged()),this):0},j.minRangeMarginRight=function(a,b){return arguments.length?1===arguments.length?r[a]?r[a].left:0:(f(a),r[a].right<b&&(r[a].right=b,E.rangeMarginChanged()),this):0},j.minRangeMarginTop=function(a,b){return arguments.length?1===arguments.length?r[a]?r[a].top:0:(f(a),r[a].top<b&&(r[a].top=b,E.rangeMarginChanged()),this):0},j.minRangeMarginBottom=function(a,b){return arguments.length?1===arguments.length?r[a]?r[a].bottom:0:(f(a),r[a].bottom<b&&(r[a].bottom=b,E.rangeMarginChanged()),this):0},j.onRangeMarginChanged=function(a,b){var c=D;a&&a.length>0&&(c=c+"."+a),b?E.on(c,function(){v&&v.call(b)}):E.on(c)},j}var d=1;b.chart.base=c}(d3,d3.trait),function(a,b){function c(c,d){function e(b){b.each(function(b){if(!l){var c=d.chartClass?"chart-line "+d.chartClass:"chart-line";l=this._chartGroup.append("g").classed(c,!0)}n=d.seriesFilter?b.filter(d.seriesFilter):b,r.domain(n),m=l.selectAll(".series").data(n),m.selectAll("path").transition().duration(500).attr("d",function(a){return t(d.seriesData(a))}),m.enter().append("g").attr("class","series").append("path").attr("class","line").attr("d",function(a){return t(d.seriesData(a))}).style("stroke",function(a,b){return r(b)}),o=a.trait.utils.extentMax(p.domain())})}function f(a,b,c,d,e,f){var g,h;for(void 0===e&&(e=0),void 0===f&&(f=a.length-1);f>=e;)if(g=Math.floor((e+f)/2),h=b(a[g]),c>h)e=g+1;else{if(!(h>c))return g;f=g-1}return 0>d?0>e+d?0:e+d:f+d>=a.length?a.length-1:f+d}function g(b,c,d){var e,g,h,i,j=b.length-1,k=c.range(),l=a.trait.utils.extentMax(k);return e=c.invert(k[0]),g=c.invert(l),h=f(b,d,e,-1),i=f(b,d,g,1,h,j),i++,b.slice(h,i)}function h(a,b){return b.x>a.x?b.x-a.x:a.x-b.x}function i(a,b){return b.y>a.y?b.y-a.y:a.y-b.y}function j(a,b){var c=h(a,b),d=i(a,b);return Math.sqrt(c*c+d*d)}function k(b,c,e,f){var g,i,k,l;return g=c[e],i=new a.trait.Point(p(d.x1(g)),q(d.y1(g))),k=j(i,f),l=h(i,f),{series:b,index:e,item:g,point:i,distance:k,distanceX:l}}var l,m,n,o,p=c.x1(),q=c.y1(),r=a.scale.category10(),s=a.trait.chart.utils.configFocus(d),t=a.svg.line().interpolate(d.interpolate||"linear").x(function(a){return p(d.x1(a))}).y(function(a){return q(d.y1(a))});return e.update=function(a,e){this._super(a,e);var f=e||c.duration(),h=function(a){return t(g(d.seriesData(a),p,d.x1))};return o=b.chart.utils.updatePathWithTrend(a,f,p,m,h,o),this},e.getFocusItems=function(b){var c=this._super(b),e=new a.trait.Point(p.invert(b.x),q.invert(b.y)),f=a.bisector(d.x1).left;return n.forEach(function(a,g){var h,i,j=d.seriesData(a),l=f(j,e.x);if(l>=j.length&&(l=j.length-1),h=k(a,j,l,b),i=h.index-1,i>=0){var m=k(a,j,i,b);"x"===s.axis?m.distanceX<h.distanceX&&(h=m):m.distance<h.distance&&(h=m)}h.distance<=s.distance&&(h.color=r(g),c.push(h))}),c},c.onChartResized("chartLine",e),e}b.chart.line=c}(d3,d3.trait),function(a,b){function c(a,b,c,d,e,f){return{x:function(c){return e(a.x1(c))+b},y:function(b){return f(a.y1(b))},width:c,height:function(b){return d-f(a.y1(b))}}}function d(a,b,c){return{cx:function(c){return b(a.x1(c))},cy:function(b){return c(a.y1(b))},r:8}}function e(b,e){function f(b){var c=f;b.each(function(b){var f=this,j=e.seriesFilter?b.filter(e.seriesFilter):b;if(!g){var k=e.chartClass?"chart-scatter "+e.chartClass:"chart-scatter";g=this._chartGroup.append("g").classed(k,!0)}o.domain(j),h=g.selectAll(".series").data(j),h.enter().append("g").attr("class","series").style("fill",function(a,b){return o(b)}),i=h.selectAll(p).data(e.seriesData),i.transition().duration(500).delay(500).ease(c.ease()).attr(d(e,m,n)),i.enter().append(p).classed("scatter-point",!0).attr(d(e,m,n)).on("mouseover",function(a){return f._svg.append("text").text("data: "+e.y1(a).toFixed(1)).attr("id","tooltip").attr("x",m(e.x1(a))+10).attr("y",n(e.y1(a))).attr("fill","black").attr("opacity",0).style("font-family","sans-serif").transition().attr("opacity",1)}).on("mouseout",function(){a.select(this).transition().duration(500).attr("fill","slateblue"),a.selectAll("#tooltip").transition().duration(500).attr("opacity",0).remove()}),i.exit().transition().style({opacity:0}).remove(),l=a.trait.utils.extentMax(m.domain())})}var g,h,i,j,k,l,m=b.x1(),n=b.y1(),o=a.scale.category10(),p="circle",q=a.dispatch("customHover");return f.update=function(d,f){this._super(d,f);var g=a.trait.utils.extentMax(m.domain()),o=m(l)-m(g);return h.attr("transform",null),i.attr(c(e,k,j,b.chartHeight(),m,n)),i=h.selectAll("rect").data(e.seriesData),i.enter().append("rect").classed("bar",!0).attr(c(e,k,j,b.chartHeight(),m,n)),i.exit().transition().style({opacity:0}).remove(),0===f?h.attr("transform","translate("+o+")"):h.transition().duration(f||b.duration()).ease("linear").attr("transform","translate("+o+")"),l=a.trait.utils.extentMax(m.domain()),this},a.rebind(f,q,"on"),b.onChartResized("chartScatter",f),b.onRangeMarginChanged("chartScatter",f),f}b.chart.scatter=e}(d3,d3.trait),function(a,b){function c(b,c,d,e,f,g){var h=a.trait.utils.extentMax(d.domain());if("trend"===b){var i=d(g)-d(h);e.attr("transform",null),e.selectAll("path").attr("d",f),0!==c&&c?e.transition().duration(c).ease("linear").attr("transform","translate("+i+")"):e.attr("transform","translate("+i+")")}else e.selectAll("path").attr("d",f);return h}function d(b){var c={distance:14,axis:null};return b.focus&&(c.distance=a.trait.utils.configFloat(b.focus.distance,c.distance),c.axis=b.focus.axis),c}b.chart.utils.updatePathWithTrend=c,b.chart.utils.configFocus=d}(d3,d3.trait),function(a,b){function c(b,c){function d(){var a=m.empty()?j.domain():m.extent();k[l+"Domain"](a),k.update("domain",0)}function e(b){var d=e;b.each(function(){if(!f){var b="brush brush-"+h,e=c.chartClass?b+c.chartClass:b;f=this._chartGroup.append("g").classed(e,!0).call(m)}f.selectAll("rect").attr("y",-6).attr("height",d.chartHeight()+7),g=a.trait.utils.extentMax(j.domain())})}var f,g,h=c.axis,i=h.charAt(0),j=b[h](),k=c.target,l=c.targetAxis,m=(k[c.targetAxis](),a.svg.brush()[i](j));m.on("brush",d);var n=a.dispatch("customHover");return e.update=function(b,c){return this._super(b,c),g=a.trait.utils.extentMax(j.domain()),this},a.rebind(e,n,"on"),b.onChartResized("controlBrush",e),e}b.control.brush=c}(d3,d3.trait),function(a,b){function c(a,b){return"l"+a+","+b}function d(a,b,c,d){return"q"+a+","+b+" "+c+","+d}function e(a,b){return"m"+a+","+b}function f(a){return Math.max(.16*a,6)}function g(a,b,f,g,h,i){var j=h.x<.5?1:-1,k=Math.floor(b/2-g-f),l=2*k+2*g,m=Math.floor(a-f-f),n=e(0,0+i)+c(2*j*g,-g-i)+c(0,-k)+d(0,-f,j*f,-f)+c(j*m,0)+d(j*f,0,j*f,f)+c(0,l)+d(0,f,j*-f,f)+c(j*-m,0)+d(j*-f,0,j*-f,-f)+c(0,-k)+"z";return n}function h(a){a.forEach(function(a){a&&(a.remove=!0)})}function i(a){a.forEach(function(b,c){b&&b.remove&&(b.group.remove(),a[c]=null)})}function j(a){delete a.lastFoci,a.tooltips&&a.tooltips.forEach(function(b,c){b&&(b.group.remove(),a.tooltips[c]=null)})}function k(b,c,d){function e(b){var n=e;b.each(function(b){var e=this,o=a.trait.utils.getTraitCache(e,d);o.tooltips=b.map(function(){return null}),n.onChartMouseOut(e,function(){j(o)}),n.onFocusChange(e,function(d){if(d.length<=0)return j(o),void 0;var p=new a.trait.Point(0,.5);h(o.tooltips),d.forEach(function(d){var g=b.indexOf(d.series),h=o.tooltips[g],i=l(c.x1(d.item))+" "+c.y1(d.item);h||(h={newby:!0},h.group=e._container.append("g").attr({id:"tooltip",opacity:0}),h.path=h.group.append("path").attr("fill","darkgray"),h.text=h.group.append("text").attr({"font-family":"monospace","font-size":10,fill:"black","text-rendering":"geometric-precision"}),o.tooltips[g]=h),h.remove=!1,h.text.text(i);var j=h.text.node().getBBox();j.height=2*j.height+2*m,j.width+=2*m+f(j.height),d.rect=new a.trait.Rect(d.point,j,p)}),a.trait.layout.verticalAnchorLeftRight(d,n.chartWidth(),n.chartHeight()),d.forEach(function(c){var d=b.indexOf(c.series),e=o.tooltips[d],h=a.rgb(c.color).darker(1.4).toString(),i=c.point.y-c.rect.origin.y,j=f(c.rect.size.height),l=g(c.rect.size.width,c.rect.size.height,k,j,c.rect.anchor,i),n=2*j+m,p=c.rect.anchor.x<.5?n:-c.rect.size.width-n;e.text.attr("transform","translate("+p+","+0+")"),e.newby?(e.group.attr("transform","translate("+c.rect.origin.x+","+c.rect.origin.y+")"),e.group.transition().attr("opacity",1)):e.group.transition().attr({opacity:1,transform:"translate("+c.rect.origin.x+","+c.rect.origin.y+")"}),e.path.transition().attr({opacity:.72,fill:c.color,stroke:h,d:l}),e.newby=!1}),i(o.tooltips),o.lastFoci=d})})}a.trait.utils.configFloat(c.distance,14),c.axis;var k=4,m=3;return e}var l=a.time.format("%Y-%m-%d");b.focus.tooltip=k}(d3,d3.trait),function(a,b){function c(b,c){function d(){return"top"===h||"bottom"===h}function e(){var a,d={left:2,right:2};return c.legendMargin&&(d.left=c.legendMargin.left||d.left,d.right=c.legendMargin.right||d.right,d.top=c.legendMargin.top,d.bottom=c.legendMargin.bottom),d.left+=b.marginLeft(),d.right+=b.marginRight(),a="margin-left:"+d.left+"px;",a+="margin-right:"+d.right+"px;",d.top&&(a+="margin-top:"+d.top+"px;"),d.bottom&&(a+="margin-bottom:"+d.bottom+"px;"),a}function f(b){var i=f;b.each(function(b){if(!this._legend){var f=c.legendClass?"legend "+c.legendClass:"legend";if(d()){var j=a.select(this);this._legend="top"===h?j.insert("ul","svg"):j.append("ul"),this._legend.attr("style",e()).attr("class",f)}else this._legend=this._container.append("g").classed(f,!0)}var k=c.legendFilter?b.filter(c.legendFilter):b;if(g.domain(k),d()){var l=this._legend.selectAll("li").data(k);l.enter().append("li").attr("class","legend-item").style("border-bottom-color",function(a,b){return g(b)}).text(c.seriesLabel)}else{var m=this._legend.selectAll(".legend").data(k);m.enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"}),m.append("rect").attr("x",i.chartWidth()-18).attr("width",18).attr("height",18).style("fill",function(a,b){return g(b)}),m.append("text").attr("x",i.chartWidth()-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(c.seriesLabel)}})}var g=a.scale.category10(),h=c.orient||"top",i=a.dispatch("customHover");return a.rebind(f,i,"on"),b.onChartResized("legendSeries",f),f}b.legend.series=c}(d3,d3.trait),function(a,b){function c(a){return p.indexOf(a)>=0}function d(a,b){return{series:a.seriesData,data:a[b]}}function e(a){return{domain:a.domain,trend:a.trend}}function f(b,c){var d,e,f;return d=b.map(function(b){return a.extent(c.series(b),c.data)}),e=a.min(d,function(a){return a[0]}),f=a.max(d,function(a){return a[1]}),[e,f]}function g(b,c){return a.max(b.map(function(b){return a.max(c.series(b),c.data)}))}function h(a,b){var d,e=b.count||1;return d=c(b.interval)?b.interval.offset(a,0-e):a instanceof Date?a.getTime()-b.interval*e:a-b.interval*e}function i(a,b,c){var d,e,i;return a.track===o?(e=new Date,d=h(e,a.domain),i=[d,e]):a.domain&&a.domain.interval?(e=g(b,c),d=h(e,a.domain),i=[d,e]):i=f(b,c),i}function j(a,b,c){if(a.domain)return a.domain;var d;return d=a.trend?i(a,b,c):f(b,c)}function k(a,b,c,d,e){var i,j,k,l,m,n;if(a.range(b),c.domain)return a.domain(c.domain),void 0;if(l=a.domain(),m=l[l.length-1],c.trend){var p=c.trend;p.track===o?(j=new Date,i=h(j,p.domain),a.domain([i,j])):p.domain&&p.domain.interval?(j=g(d,e),i=h(m,p.domain),a.domain([i,m]),n=a(j),i=h(j,p.domain),a.domain([i,j]),a.range([b[0],n])):(k=f(d,e),a.domain(k))}else k=f(d,e),a.domain(k)}function l(b,c){function d(a){var b=d;a.each(function(a){var c,d="x"===f?b.chartWidth():b.chartHeight();h.rangeRoundBands([0,d],.1),c=a[0].map(g),h.domain(c)})}var e=c.axis,f=e.charAt(0),g=c[e],h=a.scale.ordinal();return d[e]=function(){return h},d}function m(b,c){function f(b){var d=f;b.each(function(b){g=b,m.domain(j(l,b,i)),c.nice&&m.nice(c.nice),m.range(a.trait.utils.getChartRange(d,h))})}var g,h=c.axis,i=(h.charAt(0),d(c,h)),l=e(c),m=a.time.scale();return b.minRangeMargin(h,c.minRangeMargin),f[h]=function(){return m},f[h+"Domain"]=function(a){l.domain=a,m.domain(a)},f.update=function(c,d){this._super(c,d);var e=a.trait.utils.getChartRange(b,h);return k(m,e,l,g,i),this},b.onChartResized("scaleTime"+h,f),b.onRangeMarginChanged("scaleTime-"+h,f),f}function n(b,c){function f(b){var c=f;b.each(function(b){var d,e,f;g=b,d=b.map(function(b){return a.extent(j.series(b),j.data)}),e=a.min(d,function(a){return a[0]}),f=a.max(d,function(a){return a[1]});var h="x"===i?[0,c.chartWidth()]:[c.chartHeight(),0];m.domain([e,f]).range(h)})}var g,h=c.axis,i=h.charAt(0),j=d(c,h),l=e(c),m=a.scale.linear();return b.minRangeMargin(c.axis,c.minRangeMargin),f[h]=function(){return m},f.update=function(c,d){this._super(c,d);var e=a.trait.utils.getChartRange(b,h);return k(m,e,l,g,j),this},b.onChartResized(h,f),f}var o="current-time",p=[a.time.second,a.time.minute,a.time.hour,a.time.day,a.time.week,a.time.month,a.time.year];b.scale.ordinal||(b.scale.ordinal={}),b.scale.linear=n,b.scale.ordinal.bars=l,b.scale.time=m}(d3,d3.trait);